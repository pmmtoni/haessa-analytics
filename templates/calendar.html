{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="text-center mb-4">ðŸ“… HAESSA Component Delivery Calendar</h2>

  <!-- âœ… Calendar Display -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <div id="calendar"></div>
    </div>
  </div>

  <!-- âœ… Delivery Summary Table -->
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <h5 class="card-title mb-3 text-secondary">Upcoming & Overdue Deliveries</h5>
      {% if events %}
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th scope="col">ðŸ“† Date</th>
              <th scope="col">ðŸš† Component Event</th>
            </tr>
          </thead>
          <tbody>
            {% for e in events %}
            <tr>
              <td>{{ e.start }}</td>
              <td>{{ e.title }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted text-center m-3">No events scheduled yet.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- âœ… FullCalendar (modern CDN) -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<!-- âœ… Bootstrap Tooltip support -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const calendarEl = document.getElementById("calendar");

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    height: 650,
    events: {{ events | tojson }},
    headerToolbar: {
      left: "prev,next today",
      center: "title",
      right: "dayGridMonth,listWeek"
    },
    eventDisplay: "block",
    eventTimeFormat: { hour: "2-digit", minute: "2-digit", hour12: false },
    eventDidMount: function(info) {
      // Add tooltip for component details
      new bootstrap.Tooltip(info.el, {
        title: info.event.title,
        placement: "top",
        trigger: "hover",
        container: "body"
      });
    },
    eventColor: "#0d6efd",
    eventTextColor: "#fff",
    nowIndicator: true,
  });

  calendar.render();
});
</script>
{% endblock %}
