# -*- coding: utf-8 -*-
"""
Created on Wed Oct  8 22:59:27 2025

@author: Paul
"""

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HAESSA Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
.navbar {
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1030; /* keeps it above other elements */
}

body {
  padding-top: 70px; /* prevent content from hiding behind navbar */
}
</style>

<style>
.container {
  max-width: 1200px;
}
canvas {
  max-width: 100%;
}
.table th, .table td {
  vertical-align: middle;
}
</style>

<style>
.toast {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.4s ease-in-out;
}
.toast.show {
  opacity: 1 !important;
  transform: translateY(0) !important;
}
</style>

<!-- üîπ Activity Log Sidebar -->
<div id="activityLog" class="activity-log shadow-lg">
  <div class="activity-header bg-dark text-white p-2 d-flex justify-content-between align-items-center">
    <span>üìú Activity Log</span>
    <button class="btn btn-sm btn-light" id="clearLog">Clear</button>
  </div>
  <div class="activity-body p-2" id="logBody">
    <p class="text-muted small text-center">No recent activity</p>
  </div>
</div>

<!-- üîπ Toggle Button -->
<button id="toggleLog" class="btn btn-dark position-fixed rounded-circle">
  üïì
</button>

<style>
/* --- Sidebar styles --- */
.activity-log {
  position: fixed;
  right: -320px;
  top: 0;
  width: 300px;
  height: 100%;
  background-color: #f8f9fa;
  transition: right 0.4s ease;
  z-index: 2000;
  border-left: 3px solid #0d6efd;
}
.activity-log.active {
  right: 0;
}
#toggleLog {
  bottom: 25px;
  right: 25px;
  width: 50px;
  height: 50px;
  z-index: 2100;
  font-size: 1.2rem;
}
.activity-body {
  height: calc(100% - 50px);
  overflow-y: auto;
  font-size: 0.9rem;
}
.activity-item {
  border-bottom: 1px solid #ddd;
  padding: 6px 0;
}
.activity-item small {
  display: block;
  font-size: 0.75rem;
  color: #6c757d;
}
</style>

<script>
// üîπ Activity Log Toggle
document.getElementById("toggleLog").addEventListener("click", () => {
  document.getElementById("activityLog").classList.toggle("active");
});

// üîπ Clear Log
document.getElementById("clearLog").addEventListener("click", () => {
  localStorage.removeItem("activityLog");
  document.getElementById("logBody").innerHTML = `<p class="text-muted small text-center">No recent activity</p>`;
});

// üîπ Add Log Entry Function
function addLogEntry(action, message, color = "dark") {
  const logBody = document.getElementById("logBody");
  const timestamp = new Date().toLocaleTimeString();
  const entry = document.createElement("div");
  entry.className = "activity-item";
  entry.innerHTML = `
    <span class="text-${color}">${action}: ${message}</span>
    <small>${timestamp}</small>
  `;
  logBody.prepend(entry);

  // Save to localStorage (for persistence)
  const logs = JSON.parse(localStorage.getItem("activityLog") || "[]");
  logs.unshift({ action, message, color, timestamp });
  localStorage.setItem("activityLog", JSON.stringify(logs));
}

// üîπ Restore Logs on Load
document.addEventListener("DOMContentLoaded", () => {
  const logBody = document.getElementById("logBody");
  const logs = JSON.parse(localStorage.getItem("activityLog") || "[]");
  if (logs.length) {
    logBody.innerHTML = "";
    logs.forEach(log => {
      const entry = document.createElement("div");
      entry.className = "activity-item";
      entry.innerHTML = `
        <span class="text-${log.color}">${log.action}: ${log.message}</span>
        <small>${log.timestamp}</small>
      `;
      logBody.append(entry);
    });
  }
});
</script>


</head>

<!-- Inside <head> ... before </head> -->
<style>
.toast-container {
  position: fixed;
  top: 15px;
  right: 15px;
  z-index: 2500;
}
.toast {
  opacity: 0.95;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  border-radius: 10px;
  transition: transform 0.3s ease-in-out, opacity 0.3s ease;
}
.toast:hover {
  transform: scale(1.02);
  opacity: 1;
}
.toast .toast-body {
  font-size: 0.95rem;
}
</style>


<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="{{ url_for('home') }}">üöÜ HAESSA</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('home') }}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('add') }}">Add</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('analytics') }}">Analytics</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('chart') }}">Chart</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('calendar') }}">Calendar</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('pie') }}">Pie</a></li>

        {% if current_user.is_authenticated and current_user.role == 'admin' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('users') }}">üë• User Management</a></li>
        {% endif %}
      </ul>

      <ul class="navbar-nav">
        {% if current_user.is_authenticated %}
          <li class="nav-item">
            <span class="navbar-text text-light me-3">
              Logged in as <strong>{{ current_user.username }}</strong> ({{ current_user.role|capitalize }})
            </span>
          </li>
          <li class="nav-item">
            <a class="btn btn-outline-light btn-sm" href="{{ url_for('logout') }}">Logout</a>
          </li>
        {% else %}
          <li class="nav-item">
            <a class="btn btn-outline-light btn-sm" href="{{ url_for('login') }}">Login</a>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>


  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('home') }}">üöÜ HAESSA</a>
      <div class="navbar-nav">
        <a class="nav-link" href="{{ url_for('home') }}">Home</a>
        <a class="nav-link" href="{{ url_for('add') }}">Add</a>
        <a class="nav-link" href="{{ url_for('analytics') }}">Analytics</a>
        <a class="nav-link" href="{{ url_for('chart') }}">Chart</a>
        <a class="nav-link" href="{{ url_for('calendar') }}">Calendar</a>
        <a class="nav-link" href="{{ url_for('pie') }}">Pie</a>
        <a class="nav-link" href="{{ url_for('login') }}">Login</a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        {% for category, message in messages %}
          showToast("{{ message }}", "{{ category }}");
        {% endfor %}
      });
    </script>
  {% endif %}
{% endwith %}

<style>
.chart-container {
    max-width: 500px;
    height: 400px;
    margin: 0 auto;
    padding: 10px;
    position: relative;
}
</style>





    {% block content %}{% endblock %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- üîπ Toast Container for Flask Flash Messages -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 9999;">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
      <div class="toast align-items-center text-white bg-{{ 'success' if category == 'success' else 'danger' if category == 'danger' else 'warning' if category == 'warning' else 'info' }} border-0 show mb-2" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body">
            {{ message }}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const toastElList = [].slice.call(document.querySelectorAll('.toast'));
  toastElList.map(function(toastEl) {
    const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
    toast.show();
  });
});
</script>

<!-- üîπ Toast Container (Universal for Flask Flash + AJAX feedback) -->
<div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 9999;">
  <!-- Dynamic toasts injected here -->
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// üîπ Function to show Bootstrap Toast dynamically
function showToast(message, category = "success") {
  const colors = {
    success: "bg-success text-white",
    danger: "bg-danger text-white",
    warning: "bg-warning text-dark",
    info: "bg-info text-dark"
  };
  const toastHTML = `
    <div class="toast align-items-center ${colors[category] || 'bg-secondary text-white'} border-0 show mb-2" role="alert">
      <div class="d-flex">
        <div class="toast-body">${message}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  `;
  const container = document.querySelector(".toast-container");
  container.insertAdjacentHTML("beforeend", toastHTML);
  const toastEl = container.lastElementChild;
  const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
  toast.show();
  toastEl.addEventListener("hidden.bs.toast", () => toastEl.remove());
}
</script>

<!-- üîπ Toast Notification Container -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 2500">
  <!-- Toasts will be dynamically appended here -->
</div>

<script>
// ‚úÖ Bootstrap 5 Toast System
function showToast(message, type = "info") {
  const colors = {
    success: "#198754",
    danger: "#dc3545",
    warning: "#ffc107",
    info: "#0dcaf0",
    primary: "#0d6efd"
  };

  const icons = {
    success: "‚úÖ",
    danger: "‚ùå",
    warning: "‚ö†Ô∏è",
    info: "‚ÑπÔ∏è",
    primary: "üöÜ"
  };

  const toastId = "toast-" + Date.now();
  const toastHTML = `
    <div id="${toastId}" class="toast align-items-center text-white border-0 show" role="alert" aria-live="assertive" aria-atomic="true"
         style="background-color: ${colors[type] || colors.info}; min-width: 280px;">
      <div class="d-flex">
        <div class="toast-body fw-semibold">
          ${icons[type] || ""} ${message}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  `;

  const container = document.querySelector(".toast-container");
  container.insertAdjacentHTML("beforeend", toastHTML);

  const toastElement = document.getElementById(toastId);
  const bsToast = new bootstrap.Toast(toastElement, { delay: 3500 });
  bsToast.show();

  // Remove after fade-out
  setTimeout(() => {
    toastElement.classList.remove("show");
    setTimeout(() => toastElement.remove(), 500);
  }, 4000);
}
</script>



</body>
</html>

<style>
/* --- Ensure dropdowns always appear above modals --- */
.modal {
  z-index: 1060 !important;
}
.modal-backdrop {
  z-index: 1050 !important;
}
.dataTables_filter,
.dataTables_length,
.dropdown-menu,
.select2-container,
.ui-autocomplete {
  z-index: 2000 !important;
}

/* Prevent body scroll lock from shifting page content when modal opens */
.modal-open {
  overflow: auto !important;
  padding-right: 0 !important;
}
</style>

<style>
/* --- Fix for add page dropdowns being hidden --- */
.form-select,
select,
input[type="text"],
input[type="date"] {
  position: relative;
  z-index: 2050 !important;
}

/* --- For Bootstrap dropdowns used inside forms --- */
.dropdown-menu.show {
  z-index: 2055 !important;
}

/* --- In case form container has overflow hidden --- */
.form-container, .modal-body {
  overflow: visible !important;
}
</style>
