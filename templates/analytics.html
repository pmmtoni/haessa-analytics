{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4 text-center">ðŸ“Š HAESSA Component Analytics Dashboard</h2>

  <!-- âœ… Overview Cards -->
  <div class="row text-center mb-4">
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title text-secondary">Total Components</h5>
          <h3 class="fw-bold text-dark">{{ overall_chart.total }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title text-secondary">Overdue</h5>
          <h3 class="fw-bold text-danger">{{ overall_chart.values[4] }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title text-secondary">Paid</h5>
          <h3 class="fw-bold text-success">{{ overall_chart.values[3] }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title text-secondary">Incomplete</h5>
          <h3 class="fw-bold text-warning">{{ overall_chart.values[0] }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Chart Section -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title text-center">Overall Component Status Distribution</h5>
      <canvas id="overallChart" height="150"></canvas>
    </div>
  </div>

  <!-- âœ… Trend Charts -->
  <div class="row">
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title text-center">ðŸ“ˆ Monthly Performance Trends</h5>
          <canvas id="monthlyTrendChart" height="200"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="card-title text-center">ðŸ“… Weekly Performance Trends</h5>
          <canvas id="weeklyTrendChart" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Footer Info -->
  <div class="text-muted text-center mt-4 small">
    <p>Generated by <strong>{{ generated_by }}</strong></p>
    <p><em>{{ generated_at }}</em></p>
  </div>
</div>

<!-- âœ… Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  // Overall Chart
  const overallCtx = document.getElementById("overallChart").getContext("2d");
  new Chart(overallCtx, {
    type: "doughnut",
    data: {
      labels: {{ overall_chart.labels|tojson }},
      datasets: [{
        data: {{ overall_chart.values|tojson }},
        backgroundColor: [
          "#ffc107", "#0d6efd", "#6c757d", "#28a745", "#dc3545", "#20c997", "#6610f2"
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "bottom" },
        title: {
          display: true,
          text: "Component Status Overview"
        }
      }
    }
  });

  // Monthly Trend Chart
  const monthlyCtx = document.getElementById("monthlyTrendChart").getContext("2d");
  new Chart(monthlyCtx, {
    type: "line",
    data: {
      labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
      datasets: [
        {
          label: "On Time",
          data: {{ trend_data.monthly["On Time"]|tojson }},
          borderColor: "#28a745",
          tension: 0.3
        },
        {
          label: "Late",
          data: {{ trend_data.monthly["Late"]|tojson }},
          borderColor: "#dc3545",
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "bottom" }
      }
    }
  });

  // Weekly Trend Chart
  const weeklyCtx = document.getElementById("weeklyTrendChart").getContext("2d");
  new Chart(weeklyCtx, {
    type: "bar",
    data: {
      labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
      datasets: [
        {
          label: "On Time",
          data: {{ trend_data.weekly["On Time"]|tojson }},
          backgroundColor: "#20c997"
        },
        {
          label: "Late",
          data: {{ trend_data.weekly["Late"]|tojson }},
          backgroundColor: "#dc3545"
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "bottom" }
      }
    }
  });
});
</script>
{% endblock %}
